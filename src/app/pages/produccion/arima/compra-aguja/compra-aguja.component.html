<div class="row">
    <div class="col-12">

        <div class="card border-left border-info">
            <div class="card-header bg-info text-white" style="font-weight: bold;">
                Reporte de Aguja
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <label class="control-label text-white">&nbsp;&nbsp;</label>
                        <div class="form-group">
                            <button class="btn btn-success btn-sm text-white" (click)="exportarExcel()"
                                style="background-color: #25aa00;border: none;">
                                <i class="fas fa-file-excel" *ngIf="!flagEsperaExcel"></i>
                                <i class="fa fa-spinner fa-spin fa-fw" *ngIf="flagEsperaExcel"></i> Excel</button>
                        </div>
                    </div>
                </div>
                <div class="row pb-1">
                    <div class="col-md-4">
                        <input type="text" style="float: right" [formControl]='textFiltrarAgujas'
                            placeholder="Buscar Item o Descripción" class="form-control rounded-pill font-bold">
                    </div>
                    <div class="col-md-4">
                    </div>
                    <div class="col-md-4 d-flex justify-content-end">
                        <div class="form-check form-check-inline">
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" [formControl]="checkMostrarColumna" class="custom-control-input"
                                    id="customCheck1">
                                <label class="custom-control-label" for="customCheck1">Visualizar detalle</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12" style="height: 80vh;">
                        <ngx-datatable class="material" [reorderable]="false" [rows]="listadoCompraAguja"
                            [columnMode]="'force'" [headerHeight]="50" [footerHeight]="50" [rowHeight]="50"
                            [scrollbarV]="true" [sorts]="[{prop: 'name', dir: 'desc'}]" [loadingIndicator]="flagEspera"
                            style="height: 90%;" class="material font-medium" [rowHeight]="50" [scrollbarH]="true">

                            <ngx-datatable-column name="ItemFinal" prop="itemFinal" [frozenLeft]="true" [width]="20">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium">{{row.itemFinal }}</span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="Descripción" prop="descripcionLocal" [frozenLeft]="true"
                                [width]="120">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium">{{row.descripcionLocal }}</span>
                                </ng-template>
                            </ngx-datatable-column>


                            <ngx-datatable-column name="Longuitud" prop="longAguja" [frozenLeft]="true" [width]="40">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium">{{row.longAguja }}</span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="Familia" prop="familiaLarga" [frozenLeft]="true" [width]="60">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium">{{row.familiaLarga }}</span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="T.Compra" prop="tiempoCompra"
                                *ngIf="this.checkMostrarColumna.value" [width]="30">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium">{{row.tiempoCompra | number : '1.0-0'}}</span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="T.Pago" prop="tiempoPago" *ngIf="this.checkMostrarColumna.value"
                                [width]="30">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium">{{row.tiempoPago | number : '1.0-0'}}</span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="T. Aprobacion" prop="tiempoAprobacion"
                                *ngIf="this.checkMostrarColumna.value" [width]="30">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium">{{row.tiempoAprobacion | number : '1.0-0'}}</span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="T. Fabricacion" prop="tiempofabricacion"
                                *ngIf="this.checkMostrarColumna.value" [width]="30">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium">{{row.tiempofabricacion | number : '1.0-0'}}</span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="T. Transporte" prop="tiempoTransporte"
                                *ngIf="this.checkMostrarColumna.value" [width]="30">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium">{{row.tiempoTransporte | number : '1.0-0'}}</span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="T. Aduana" prop="tiempoAduanas"
                                *ngIf="this.checkMostrarColumna.value" [width]="30">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium">{{row.tiempoAduanas | number : '1.0-0'}}</span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="CantMinima" prop="cantidadMinima" [width]="30">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium">{{row.cantidadMinima | number : '1.0-0'}}</span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="Maximo stock" prop="maximoStock" [width]="30">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium">{{row.maximoStock | number : '1.0-0'}}</span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="Punto corte" prop="puntoCorte" [width]="30">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium">{{row.puntoCorte | number : '1.0-0'}}</span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="Almacen" prop="almacen" [width]="30">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium">{{row.almacen | number : '1.0-0'}}</span>
                                </ng-template>
                            </ngx-datatable-column>




                            <ngx-datatable-column name="Transito" prop="pendienteOC" [width]="30">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span *ngIf="row.pendienteOC<=0" class="font-medium">{{row.pendienteOC | number:'1.2-2' }}</span>
                                    <button class="btn btn-sm btn-outline-primary btn-rounded font-medium" type="button"
                                        *ngIf="row.pendienteOC>0" (click)="abrirModalMostrarOC(modalPendienteOC, row.itemFinal)">
                                        {{ row.pendienteOC | number : '1.' }}
                                    </button>
                                </ng-template>

                            </ngx-datatable-column>

                            <ngx-datatable-column name="Aduans" prop="aduanas" [width]="30">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium">{{row.aduanas | number : '1.0-0'}}</span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="C.Calidad" prop="controlCalidad" [width]="30">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium">{{row.controlCalidad | number : '1.0-0'}}</span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="Disponible" prop="disponible" [width]="30">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium">{{row.disponible | number : '1.0-0'}}</span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="Dia Potencial" prop="diasPotencial"
                                *ngIf="this.checkMostrarColumna.value" [width]="30">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium">{{row.diasPotencial | number : '1.0-0'}}</span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="Pronostico" prop="pronostico" [width]="30">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium">{{row.pronostico | number : '1.0-0'}}</span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="Consumo Dia" prop="consumoDia"
                                *ngIf="this.checkMostrarColumna.value" [width]="30">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium">{{row.consumoDia | number : '1.0-0'}}</span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="Dias Llegada" prop="demoraLlegarProducto"
                                *ngIf="this.checkMostrarColumna.value" [width]="30">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium">{{row.demoraLlegarProducto | number : '1.0-0'}}</span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="Desviacion" prop="desviacionCompra"
                                *ngIf="this.checkMostrarColumna.value" [width]="30">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium">{{row.desviacionCompra | number : '1.1-1'}}</span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="DiasEspera" prop="diasEspera" [width]="30">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium"
                                        [ngStyle]="{ 'color': row.diasEspera > 0 ? 'blue' : 'red' }">{{row.diasEspera}}</span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="Variacion" prop="variacion"
                                *ngIf="this.checkMostrarColumna.value" [width]="40">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium">{{row.pronostico | number : '1.0-0'}}</span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="CantComprar" prop="cantidadComprar" [width]="40">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span class="font-medium">{{row.cantidadComprar | number : '1.0-0'}}</span>
                                </ng-template>
                            </ngx-datatable-column>

                        </ngx-datatable>
                    </div>
                </div>

            </div>

        </div>

    </div>
</div>


<ng-template #modalPendienteOC let-modal>
    <div class="modal-header">
        <h4 class="modal-title">
            Ordenes de compra pendientes
        </h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
            <span aria-hidden="true">
                &times;
            </span>
        </button>
    </div>
    <div class="modal-body">
        <p class="text-info">ITEM: {{itemModal}} - {{descripcionModal}}</p>
        <div class="table-responsive table-sm">
            <table class="table table-striped no-wrap border mt-4" style="font-size: 13px;">
                <thead>
                    <tr>
                        <th class="text-center">Nro Orden</th>
                        <th class="text-center">Proveedor</th>
                        <th class="text-center">C. Pedido</th>
                        <th class="text-center">C. Recibida</th>
                        <th class="text-center">C. Pendiente</th>
                        <th class="text-center">Fec. Prometida</th>
                        <th class="text-center">Dif. Días</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let ordenCompra of listaDettalleCC">
                        <td class="text-center font-medium">
                            {{ ordenCompra['numeroOrden'] }}
                        </td>
                        <td class="text-center font-medium">
                            {{ ordenCompra['proveedor'] }}
                        </td>
                        <td class="text-center font-medium">
                            {{ ordenCompra['cantidad'] | number }}
                        </td>
                        <td class="text-center font-medium">
                            {{ ordenCompra['cantidadRecibida'] | number }}
                        </td>
                        <td class="text-center font-medium">
                            {{ ordenCompra['pendienteOC'] | number }}
                        </td>
                        <td class="text-center font-medium">
                            {{ ordenCompra['fecha'] | date:'dd/MM/yyyy' }}
                        </td>
                        <td class="text-center font-medium"
                            [ngStyle]="{'color':ordenCompra['diferenciaFecha']>0 ? '#FC0000':'#27E900' }">
                            {{ ordenCompra['diferenciaFecha'] }}
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</ng-template>